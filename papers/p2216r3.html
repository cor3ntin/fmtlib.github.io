<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>D2216R3: std::format improvements</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in Â§N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li .secno { font-size: 85%; }
	.toc > li li li li li { font-size:   85%;    }
	.toc > li li li li li .secno { font-size: 100%; }

	/* @supports not (display:grid) { */
		.toc > li             { margin: 1.5rem 0;    }
		.toc > li li          { margin: 0.3rem 0;    }
		.toc > li li li       { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}

		.toc li {
			clear: both;
		}

		:not(li) > .toc              { margin-left:  5rem; }
		.toc .secno                  { margin-left: -5rem; }
		.toc > li li li .secno       { margin-left: -7rem; }
		.toc > li li li li .secno    { margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc              { margin-left:  4rem; }
			.toc .secno                  { margin-left: -4rem; }
			.toc > li li li              { margin-left:  1rem; }
			.toc > li li li .secno       { margin-left: -5rem; }
			.toc > li li li li .secno    { margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			   comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
		}
		#toc .content:hover {
			background: rgba(75%, 75%, 75%, .25);
			border-bottom: 3px solid #054572;
			margin-bottom: -3px;
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good table positioning:
		   "content column" is 50ems wide at max; less on smaller screens.
		   Extra space (after ToC + content) is empty on the right.

		   1. When table < content column, centers table in column.
		   2. When content < table < available, left-aligns.
		   3. When table > available, fills available + scroll bar.
		*/
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
<style type="text/css">
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      vertical-align: top;
    }
    th, td {
      border-left: none;
      border-right: none;
      padding: 0px 10px;
    }
    th {
      text-align: center;
    }

    del { background: #fcc; color: #000; text-decoration: line-through; }
    ins { background: #cfc; color: #000; }
    blockquote .highlight:not(.idl) { background: initial; margin: initial; padding: 0.5em }
    blockquote ul { background: inherit; }
    blockquote code.highlight:not(.idl) { padding: initial; }
    blockquote c-[a] { color: inherit; } /* Keyword.Declaration */
    blockquote c-[b] { color: inherit; } /* Keyword.Type */
    blockquote c-[c] { color: inherit; } /* Comment */
    blockquote c-[d] { color: inherit; } /* Comment.Multiline */
    blockquote c-[e] { color: inherit; } /* Name.Attribute */
    blockquote c-[f] { color: inherit; } /* Name.Tag */
    blockquote c-[g] { color: inherit; } /* Name.Variable */
    blockquote c-[k] { color: inherit; } /* Keyword */
    blockquote c-[l] { color: inherit; } /* Literal */
    blockquote c-[m] { color: inherit; } /* Literal.Number */
    blockquote c-[n] { color: inherit; } /* Name */
    blockquote c-[o] { color: inherit; } /* Operator */
    blockquote c-[p] { color: inherit; } /* Punctuation */
    blockquote c-[s] { color: inherit; } /* Literal.String */
    blockquote c-[t] { color: inherit; } /* Literal.String.Single */
    blockquote c-[u] { color: inherit; } /* Literal.String.Double */
    blockquote c-[cp] { color: inherit; } /* Comment.Preproc */
    blockquote c-[c1] { color: inherit; } /* Comment.Single */
    blockquote c-[cs] { color: inherit; } /* Comment.Special */
    blockquote c-[kc] { color: inherit; } /* Keyword.Constant */
    blockquote c-[kn] { color: inherit; } /* Keyword.Namespace */
    blockquote c-[kp] { color: inherit; } /* Keyword.Pseudo */
    blockquote c-[kr] { color: inherit; } /* Keyword.Reserved */
    blockquote c-[ld] { color: inherit; } /* Literal.Date */
    blockquote c-[nc] { color: inherit; } /* Name.Class */
    blockquote c-[no] { color: inherit; } /* Name.Constant */
    blockquote c-[nd] { color: inherit; } /* Name.Decorator */
    blockquote c-[ni] { color: inherit; } /* Name.Entity */
    blockquote c-[ne] { color: inherit; } /* Name.Exception */
    blockquote c-[nf] { color: inherit; } /* Name.Function */
    blockquote c-[nl] { color: inherit; } /* Name.Label */
    blockquote c-[nn] { color: inherit; } /* Name.Namespace */
    blockquote c-[py] { color: inherit; } /* Name.Property */
    blockquote c-[ow] { color: inherit; } /* Operator.Word */
    blockquote c-[mb] { color: inherit; } /* Literal.Number.Bin */
    blockquote c-[mf] { color: inherit; } /* Literal.Number.Float */
    blockquote c-[mh] { color: inherit; } /* Literal.Number.Hex */
    blockquote c-[mi] { color: inherit; } /* Literal.Number.Integer */
    blockquote c-[mo] { color: inherit; } /* Literal.Number.Oct */
    blockquote c-[sb] { color: inherit; } /* Literal.String.Backtick */
    blockquote c-[sc] { color: inherit; } /* Literal.String.Char */
    blockquote c-[sd] { color: inherit; } /* Literal.String.Doc */
    blockquote c-[se] { color: inherit; } /* Literal.String.Escape */
    blockquote c-[sh] { color: inherit; } /* Literal.String.Heredoc */
    blockquote c-[si] { color: inherit; } /* Literal.String.Interpol */
    blockquote c-[sx] { color: inherit; } /* Literal.String.Other */
    blockquote c-[sr] { color: inherit; } /* Literal.String.Regex */
    blockquote c-[ss] { color: inherit; } /* Literal.String.Symbol */
    blockquote c-[vc] { color: inherit; } /* Name.Variable.Class */
    blockquote c-[vg] { color: inherit; } /* Name.Variable.Global */
    blockquote c-[vi] { color: inherit; } /* Name.Variable.Instance */
    blockquote c-[il] { color: inherit; } /* Literal.Number.Integer.Long */
  </style>
  <meta content="Bikeshed version 5f7b0e20, updated Tue Aug 18 15:46:28 2020 -0700" name="generator">
  <link href="https://isocpp.org/favicon.ico" rel="icon">
  <meta content="9e6edb0956bb240c92d46fc125b771401f4f26fa" name="document-revision">
<style type="text/css">
  td {
    vertical-align: middle;
  }
	ins { text-decoration: none; }
  ins code { background: #cfc !important; }

  .poll th, .poll td {
		text-align: right;
    width: 20%;
	}
</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "â";
}
.css::after, .property::after, .descriptor::after {
    content: "â";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "â";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "â";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "Â¶"; }
.heading > a.self-link::before { content: "Â§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-syntax-highlighting */

.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">D2216R3<br>std::format improvements</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Proposal, <time class="dt-updated" datetime="2020-02-02">2020-02-02</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Author:
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:victor.zverovich@gmail.com">Victor Zverovich</a>
     <dt>Audience:
     <dd>LEWG
     <dt>Project:
     <dd>ISO/IEC JTC1/SC22/WG21 14882: Programming Language â C++
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <hr title="Separator for header">
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#hist"><span class="secno">2</span> <span class="content">Revision history</span></a>
    <li><a href="#polls"><span class="secno">3</span> <span class="content">LEWG polls (R1)</span></a>
    <li><a href="#polls2"><span class="secno">4</span> <span class="content">LEWG polls (R0)</span></a>
    <li><a href="#checks"><span class="secno">5</span> <span class="content">Compile-time checks</span></a>
    <li><a href="#binary"><span class="secno">6</span> <span class="content">Binary size</span></a>
    <li><a href="#impact"><span class="secno">7</span> <span class="content">Impact on existing code</span></a>
    <li><a href="#wording"><span class="secno">8</span> <span class="content">Wording</span></a>
    <li><a href="#ack"><span class="secno">9</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <p style="text-align: right"> "Safety doesnât happen by accident." <br> â unknown </p>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>This paper proposes the following improvements to the C++20 formatting facility:</p>
   <ul>
    <li data-md>
     <p>Improving safety via compile-time format string checks</p>
    <li data-md>
     <p>Reducing binary code size of <code class="highlight"><c- n>format_to</c-></code></p>
   </ul>
   <h2 class="heading settled" data-level="2" id="hist"><span class="secno">2. </span><span class="content">Revision history</span><a class="self-link" href="#hist"></a></h2>
   <p>Changes since R2:</p>
   <ul>
    <li data-md>
     <p>Added an entry to Annex C summarizing the differences from C++20.</p>
    <li data-md>
     <p>Italicized <i><code class="highlight"><c- n>format</c-><c- o>-</c-><c- n>string</c-></code></i>, <i><code class="highlight"><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></code></i>, <i><code class="highlight"><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></code></i>, <i><code class="highlight"><c- n>str</c-></code></i> and deitalicized <code class="highlight"><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></code>.</p>
    <li data-md>
     <p>Replaced <code class="highlight"><c- n>fmt</c-></code> with <code class="highlight"><c- n>fmt</c-><c- p>.</c-><i><c- n>str</c-></i></code> in the Effects of <code class="highlight"><c- n>format_to</c-></code> (wide overloads).</p>
   </ul>
   <p>Changes since R1:</p>
   <ul>
    <li data-md>
     <p>Made the <code class="highlight"><c- n>str</c-></code> member of <code class="highlight"><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></code> exposition-only.</p>
    <li data-md>
     <p>Added missing <code class="highlight"><c- k>consteval</c-></code> to the <code class="highlight"><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></code> constructor.</p>
    <li data-md>
     <p>Added "A string <code class="highlight"><c- n>s</c-></code> is a format string for argument types <code class="highlight"><c- n>Args</c-></code> if there
exist <code class="highlight"><c- n>args</c-></code> of types <code class="highlight"><c- n>Args</c-></code> such that <code class="highlight"><c- n>s</c-></code> is a format string for <code class="highlight"><c- n>args</c-></code>." to
[format.string.general].</p>
    <li data-md>
     <p>Replaced "Initializes <code class="highlight"><c- n>str</c-></code>" with "Direct-non-list-initializes <code class="highlight"><c- n>str</c-></code>" in the
the <em>Effects</em> clause of the <code class="highlight"><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></code> constructor.</p>
    <li data-md>
     <p>Replaced "<code class="highlight"><c- n>is_convertible_v</c-><c- o>&lt;</c-><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-><c- p>,</c-> <c- n>basic_string_view</c-><c- o>&lt;</c-><c- n>charT</c-><c- o>>></c-></code>"
with "<code class="highlight"><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-></code> models <code class="highlight"><c- n>convertible_to</c-><c- o>&lt;</c-><c- n>basic_string_view</c-><c- o>&lt;</c-><c- n>charT</c-><c- o>>></c-></code>" in the <em>Constraints</em> clause of the <code class="highlight"><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></code> constructor.</p>
    <li data-md>
     <p>Replaced "<em>Mandates:</em> <code class="highlight"><c- n>s</c-></code> is a format string for <code class="highlight"><c- n>Args</c-></code>." with "<em>Remarks:</em> A call to this function is not a core constant expression ([expr.const])
unless <code class="highlight"><c- n>str</c-></code> is a format string for <code class="highlight"><c- n>Args</c-></code>." in the specification of the <code class="highlight"><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></code> constructor.</p>
   </ul>
   <p>Changes since R0:</p>
   <ul>
    <li data-md>
     <p>Removed "Passing an argument <code class="highlight"><c- n>fmt</c-></code> that is not a format string for parameter
pack <code class="highlight"><c- n>args</c-></code> is ill-formed with no diagnostic required." per LEWG feedback.</p>
    <li data-md>
     <p>Changed the wording to use C++20 facilities and an exposition-only <i><code class="highlight"><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></code></i> type for guaranteed diagnostic and no reliance
on compiler extensions per LEWG feedback.</p>
    <li data-md>
     <p>Added an implementation sketch to <a href="#checks">Â§â¯5 Compile-time checks</a>.</p>
    <li data-md>
     <p>Clarified why code bloat cannot be addressed just as a quality of
implementation issue in <a href="#binary">Â§â¯6 Binary size</a>.</p>
    <li data-md>
     <p>Added an example illustrating one of the cases where code bloat occurs to <a href="#binary">Â§â¯6 Binary size</a>.</p>
   </ul>
   <h2 class="heading settled" data-level="3" id="polls"><span class="secno">3. </span><span class="content">LEWG polls (R1)</span><a class="self-link" href="#polls"></a></h2>
   <p>We prefer Option 2 (only string literals) over option 1 (all constexpr format
str)</p>
   <table class="poll">
    <tbody>
     <tr>
      <th>SF 
      <th>F 
      <th>N 
      <th>A 
      <th>SA 
     <tr>
      <td>0 
      <td>3 
      <td>0 
      <td>7 
      <td>2 
   </table>
   <p>Stay with option 1</p>
   <p>We want to adopt the binary size reduction presented in P2216r1 even if it is a
breaking change against C++20.</p>
   <table class="poll">
    <tbody>
     <tr>
      <th>SF 
      <th>F 
      <th>N 
      <th>A 
      <th>SA 
     <tr>
      <td>4 
      <td>8 
      <td>0 
      <td>0 
      <td>0 
   </table>
   <p>Strong consensus for change.</p>
   <p>We would prefer the binary size reduction change to be made as a DR against C++20</p>
   <table class="poll">
    <tbody>
     <tr>
      <th>SF 
      <th>F 
      <th>N 
      <th>A 
      <th>SA 
     <tr>
      <td>7 
      <td>6 
      <td>3 
      <td>0 
      <td>0 
   </table>
   <p>Strong consensus for DR</p>
   <p>We would prefer the compile time checking change to be made as a DR against C++20</p>
   <table class="poll">
    <tbody>
     <tr>
      <th>SF 
      <th>F 
      <th>N 
      <th>A 
      <th>SA 
     <tr>
      <td>7 
      <td>7 
      <td>1 
      <td>0 
      <td>0 
   </table>
   <p>Strong consensus for DR</p>
   <p>Pending a wording review from Tim Song we want the next revision of this paper
to proceed to electronic balloting with priority B1 (focus).</p>
   <table class="poll">
    <tbody>
     <tr>
      <th>SF 
      <th>F 
      <th>N 
      <th>A 
      <th>SA 
     <tr>
      <td>9 
      <td>5 
      <td>0 
      <td>0 
      <td>0 
   </table>
   <p>Strong consensus, we want this paper to proceed</p>
   <h2 class="heading settled" data-level="4" id="polls2"><span class="secno">4. </span><span class="content">LEWG polls (R0)</span><a class="self-link" href="#polls2"></a></h2>
   <p>We should promise more committee time to pursuing the compile time checking
aspects of P2216R0, knowing that our time is scarce and this will leave less
time for other work.</p>
   <table class="poll">
    <tbody>
     <tr>
      <th>SF 
      <th>F 
      <th>N 
      <th>A 
      <th>SA 
     <tr>
      <td>6 
      <td>6 
      <td>3 
      <td>0 
      <td>0 
   </table>
   <p>Consensus to pursue</p>
   <p>We should promise more committee time to pursuing the code bloat aspects of
P2216R0, knowing that our time is scarce and this will leave less time for other
work.</p>
   <table class="poll">
    <tbody>
     <tr>
      <th>SF 
      <th>F 
      <th>N 
      <th>A 
      <th>SA 
     <tr>
      <td>3 
      <td>8 
      <td>6 
      <td>0 
      <td>0 
   </table>
   <p>Consensus to pursue</p>
   <p>We are comfortable having <code class="highlight"><c- n>std</c-><c- o>::</c-><c- n>format</c-></code> compile time check failures cause the
program to be ill-formed, no diagnostic required (IFNDR).</p>
   <table class="poll">
    <tbody>
     <tr>
      <th>SF 
      <th>F 
      <th>N 
      <th>A 
      <th>SA 
     <tr>
      <td>0 
      <td>1 
      <td>2 
      <td>4 
      <td>8 
   </table>
   <p>LEWG is not comfortable with IFNDR</p>
   <p>LEWG would prefer <code class="highlight"><c- n>std</c-><c- o>::</c-><c- n>format</c-></code> compile time check failures to cause the program
to be ill-formed (diagnostic required).</p>
   <table class="poll">
    <tbody>
     <tr>
      <th>SF 
      <th>F 
      <th>N 
      <th>A 
      <th>SA 
     <tr>
      <td>5 
      <td>7 
      <td>1 
      <td>0 
      <td>0 
   </table>
   <p>LEWG prefers ill-formed</p>
   <p>We are comfortable having <code class="highlight"><c- n>std</c-><c- o>::</c-><c- n>format</c-></code> compile time checks rely on compiler
extensions to be implementable.</p>
   <table class="poll">
    <tbody>
     <tr>
      <th>SF 
      <th>F 
      <th>N 
      <th>A 
      <th>SA 
     <tr>
      <td>3 
      <td>3 
      <td>4 
      <td>4 
      <td>0 
   </table>
   <p>LEWG is somewhat is uncomfortable with relying on compiler extensions for this
facility</p>
   <h2 class="heading settled" data-level="5" id="checks"><span class="secno">5. </span><span class="content">Compile-time checks</span><a class="self-link" href="#checks"></a></h2>
   <p>Consider the following example:</p>
<pre class="language-c++ highlight"><c- n>std</c-><c- o>::</c-><c- n>string</c-> <c- n>s</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>format</c-><c- p>(</c-><c- s>"{:d}"</c-><c- p>,</c-> <c- s>"I am not a number"</c-><c- p>);</c->
</pre>
   <p>In C++20 (<a data-link-type="biblio" href="#biblio-n4861">[N4861]</a>) it throws <code class="highlight"><c- n>format_error</c-></code> because <code class="highlight"><c- n>d</c-></code> is not a valid format
specifier for a null-terminated character string.</p>
   <p>We propose making it ill-formed resulting in a compile-time rather than a
runtime error. This will significantly improve safety of the formatting API and
bring it on par with other languages such as D (<a data-link-type="biblio" href="#biblio-d-format">[D-FORMAT]</a>) and Rust
(<a data-link-type="biblio" href="#biblio-rust-fmt">[RUST-FMT]</a>).</p>
   <p>This proposal has been successfully implemented in the open-source {fmt} library
(<a data-link-type="biblio" href="#biblio-fmt">[FMT]</a>) using only C++20 facilities and tested on Clang 11 and GCC 10. It will
become the default in the next major release of the library. The implementation
is very simple and straightforward because format string parsing in C++20 has
been designed with such checks in mind (<a data-link-type="biblio" href="#biblio-p0645">[P0645]</a>) and is already <code class="highlight"><c- k>constexpr</c-></code>.</p>
   <p>There are two options:</p>
   <ol>
    <li data-md>
     <p>Provide compile-time checks for all format strings known at compile time.</p>
    <li data-md>
     <p>Limit checks to string literals only.</p>
   </ol>
   <p>Here is a sketch of the implementation:</p>
<pre class="highlight"><c- cp>#ifdef OPTION_1 </c-><c- c1>// exposition only</c->

<c- c1>// Option 1:</c->
<c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>charT</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c-> <c- k>struct</c-> <c- n>basic_format_string</c-> <c- p>{</c->
  <c- n>basic_string_view</c-><c- o>&lt;</c-><c- n>charT</c-><c- o>></c-> <c- n>str</c-><c- p>;</c->

  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>T</c-><c- p>,</c-> <c- n>enable_if_t</c-><c- o>&lt;</c->
    <c- n>is_convertible_v</c-><c- o>&lt;</c-><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-><c- p>,</c-> <c- n>basic_string_view</c-><c- o>&lt;</c-><c- n>charT</c-><c- o>>></c-><c- p>,</c-> <c- b>int</c-><c- o>></c-> <c- o>=</c-> <c- mi>0</c-><c- o>></c->
  <c- k>consteval</c-> <c- n>basic_format_string</c-><c- p>(</c-><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-> <c- n>s</c-><c- p>)</c-> <c- o>:</c-> <c- n>str</c-><c- p>(</c-><c- n>s</c-><c- p>)</c-> <c- p>{</c->
    <c- c1>// Report a compile-time error if s is not a format string for Args.</c->
  <c- p>}</c->
<c- p>};</c->

<c- cp>#else</c->

<c- c1>// Option 2:</c->
<c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>charT</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c-> <c- k>struct</c-> <c- n>basic_format_string</c-> <c- p>{</c->
  <c- n>basic_string_view</c-><c- o>&lt;</c-><c- n>charT</c-><c- o>></c-> <c- n>str</c-><c- p>;</c->

  <c- k>template</c-><c- o>&lt;</c-><c- b>size_t</c-> <c- n>N</c-><c- o>></c->
  <c- k>consteval</c-> <c- n>basic_format_string</c-><c- p>(</c-><c- k>const</c-> <c- n>charT</c-> <c- p>(</c-><c- o>&amp;</c-><c- n>s</c-><c- p>)[</c-><c- n>N</c-><c- p>])</c-> <c- o>:</c-> <c- n>str</c-><c- p>(</c-><c- n>s</c-><c- p>)</c-> <c- p>{</c->
    <c- c1>// Report a compile-time error if s is not a format string for Args.</c->
  <c- p>}</c->

  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>T</c-><c- p>,</c-> <c- n>enable_if_t</c-><c- o>&lt;</c->
    <c- n>is_convertible_v</c-><c- o>&lt;</c-><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-><c- p>,</c-> <c- n>basic_string_view</c-><c- o>&lt;</c-><c- n>charT</c-><c- o>>></c-><c- p>,</c-> <c- b>int</c-><c- o>></c-> <c- o>=</c-> <c- mi>0</c-><c- o>></c->
  <c- n>basic_format_string</c-><c- p>(</c-><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-> <c- n>s</c-><c- p>)</c-> <c- o>:</c-> <c- n>str</c-><c- p>(</c-><c- n>s</c-><c- p>)</c-> <c- p>{}</c->
<c- p>};</c->

<c- cp>#endif</c->

<c- c1>// Same for Option 1 &amp; Option 2:</c->
<c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- k>using</c-> <c- n>format_string</c-> <c- o>=</c->
    <c- n>basic_format_string</c-><c- o>&lt;</c-><c- b>char</c-><c- p>,</c-> <c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Args</c-><c- o>></c-><c- p>...</c-><c- o>></c-><c- p>;</c->

<c- k>template</c-> <c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
<c- n>string</c-> <c- n>format</c-><c- p>(</c-><c- n>format_string</c-><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>)</c-> <c- p>{</c->
  <c- k>return</c-> <c- n>vformat</c-><c- p>(</c-><c- n>fmt</c-><c- p>.</c-><c- n>str</c-><c- p>,</c-> <c- n>make_format_args</c-><c- p>(</c-><c- n>args</c-><c- p>...));</c->
<c- p>}</c->
</pre>
   <p>Compiling our example produces the following diagnostic on Clang:</p>
<pre class="language-text highlight">&lt;source>:36:26: error: call to consteval function 'basic_format_string&lt;char, char [18]>::basic_format_string&lt;5>' is not a constant expression
  std::string s = format("{:d}", "I am not a number");
                         ^
/opt/compiler-explorer/libs/fmt/trunk/include/fmt/format.h:1422:13: note: non-constexpr function 'on_error' cannot be used in a constant expression
    handler.on_error("invalid type specifier");
            ^
...
</pre>
   <p>Comparison of different options:</p>
   <table>
    <tbody>
     <tr>
      <th>Code 
      <th>C++20 
      <th>Option 1 
      <th>Option 2 
     <tr>
      <td>
<pre class="highlight">  <c- k>auto</c-> <c- n>s</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- s>"{:d}"</c-><c- p>,</c-> <c- mi>42</c-><c- p>);</c->
</pre>
      <td>OK 
      <td>OK 
      <td>OK 
     <tr>
      <td>
<pre class="highlight">  <c- k>auto</c-> <c- n>s</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- s>"{:s}"</c-><c- p>,</c-> <c- mi>42</c-><c- p>);</c->
</pre>
      <td>throws 
      <td>ill-formed 
      <td>ill-formed 
     <tr>
      <td>
<pre class="highlight">  <c- k>constexpr</c-> <c- k>const</c-> <c- b>char</c-> <c- n>fmt</c-><c- p>[]</c-> <c- o>=</c-> <c- s>"{:d}"</c-><c- p>;</c->
  <c- k>auto</c-> <c- n>s</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- n>fmt</c-><c- p>,</c-> <c- mi>42</c-><c- p>);</c->
</pre>
      <td>OK 
      <td>OK 
      <td>OK 
     <tr>
      <td>
<pre class="highlight">  <c- k>const</c-> <c- b>char</c-> <c- n>fmt</c-><c- p>[]</c-> <c- o>=</c-> <c- s>"{:d}"</c-><c- p>;</c->
  <c- k>auto</c-> <c- n>s</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- n>fmt</c-><c- p>,</c-> <c- mi>42</c-><c- p>);</c->
</pre>
      <td>OK 
      <td>ill-formed 
      <td>ill-formed 
     <tr>
      <td>
<pre class="highlight">  <c- k>constexpr</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-> <c- n>fmt</c-> <c- o>=</c-> <c- s>"{:s}"</c-><c- p>;</c->
  <c- k>auto</c-> <c- n>s</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- n>fmt</c-><c- p>,</c-> <c- mi>42</c-><c- p>);</c->
</pre>
      <td>throws 
      <td>ill-formed 
      <td>throws 
     <tr>
      <td>
<pre class="highlight">  <c- k>const</c-> <c- b>char</c-><c- o>*</c-> <c- n>fmt</c-> <c- o>=</c-> <c- s>"{:d}"</c-><c- p>;</c->
  <c- k>auto</c-> <c- n>s</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- n>fmt</c-><c- p>,</c-> <c- mi>42</c-><c- p>);</c->
</pre>
      <td>OK 
      <td>ill-formed 
      <td>OK 
   </table>
   <p>Option 1 is safer but has the same limitation as Rustâs <code class="highlight"><c- n>format</c-><c- o>!</c-></code> of only
accepting format strings known at compile time. However, it is still possible to
pass a runtime string via <code class="highlight"><c- n>vformat</c-></code>:</p>
<pre class="highlight"><c- k>const</c-> <c- b>char</c-><c- o>*</c-> <c- n>fmt</c-> <c- o>=</c-> <c- s>"{:d}"</c-><c- p>;</c->
<c- k>auto</c-> <c- n>s</c-> <c- o>=</c-> <c- n>vformat</c-><c- p>(</c-><c- n>fmt</c-><c- p>,</c-> <c- n>make_format_args</c-><c- p>(</c-><c- mi>42</c-><c- p>));</c->
</pre>
   <p>Additionally we can provide a convenience wrapper for passing runtime strings:</p>
<pre class="highlight"><c- k>const</c-> <c- b>char</c-><c- o>*</c-> <c- n>fmt</c-> <c- o>=</c-> <c- s>"{:d}"</c-><c- p>;</c->
<c- k>auto</c-> <c- n>s</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- n>runtime_format</c-><c- p>(</c-><c- n>fmt</c-><c- p>),</c-> <c- mi>42</c-><c- p>);</c->
</pre>
   <p>Note that in the vast majority of cases format strings are literals.
For example, analyzing a sample of 100 <code class="highlight"><c- n>printf</c-></code> calls from <a data-link-type="biblio" href="#biblio-codesearch">[CODESEARCH]</a> showed
that 98 of them are string literals and 2 are string literals wrapped in the <code class="highlight"><c- n>_</c-></code> gettext macro:</p>
<pre class="highlight"><c- n>printf</c-> <c- p>(</c-><c- n>_</c-><c- p>(</c-><c- s>"call to tc_aout_fix_to_chars </c-><c- se>\n</c-><c- s>"</c-><c- p>));</c->
</pre>
   <p>In this case translation and runtime format markers can be combined without any
impact on usability.</p>
   <p>We propose making <code class="highlight"><c- n>basic_format_string</c-></code> exposition-only because it is an
implementation detail and in the future the same functionality can be
implemented using <a data-link-type="biblio" href="#biblio-p1221">[P1221]</a> (see e.g. <a href="https://godbolt.org/z/hcnxfY">https://godbolt.org/z/hcnxfY</a>) or <a data-link-type="biblio" href="#biblio-p1045">[P1045]</a>.</p>
   <p>From the extensive usage experience in the {fmt} library (<a data-link-type="biblio" href="#biblio-fmt">[FMT]</a>) that provides
compile-time checks as an opt-in weâve found that users expect errors in literal
format strings to be diagnosed at compile time by default. One of the reasons is
that such diagnostic is commonly done in <code class="highlight"><c- n>printf</c-></code>, for example:</p>
<pre class="language-c++ highlight"><c- n>printf</c-><c- p>(</c-><c- s>"%d"</c-><c- p>,</c-> <c- s>"I am not a number"</c-><c- p>);</c->
</pre>
   <p>gives a warning both in GCC and clang:</p>
<pre class="highlight"><c- nl>warning</c-><c- p>:</c-> <c- n>format</c-> <c- n>specifies</c-> <c- n>type</c-> '<c- b>int</c->' <c- n>but</c-> <c- n>the</c-> <c- n>argument</c-> <c- n>has</c-> <c- n>type</c-> '<c- k>const</c-> <c- b>char</c-> <c- o>*</c->' <c- p>[</c-><c- o>-</c-><c- n>Wformat</c-><c- p>]</c->
</pre>
   so users expect the same or better level of diagnostics from a similar C++
facility. 
   <h2 class="heading settled" data-level="6" id="binary"><span class="secno">6. </span><span class="content">Binary size</span><a class="self-link" href="#binary"></a></h2>
   <p>The <code class="highlight"><c- n>vformat_to</c-></code> functions take format arguments parameterized on the output
iterator via the formatting context:</p>
<pre class="language-c++ highlight"><c- n>template</c-><c- o>&lt;</c-><c- n>class</c-> <c- n>Out</c-><c- p>,</c-> <c- n>class</c-> <c- n>charT</c-><c- o>></c->
    <c- n>using</c-> <c- n>format_args_t</c-> <c- o>=</c-> <c- n>basic_format_args</c-><c- o>&lt;</c-><c- n>basic_format_context</c-><c- o>&lt;</c-><c- n>Out</c-><c- p>,</c-> <c- n>charT</c-><c- o>>></c-><c- p>;</c->

<c- n>template</c-><c- o>&lt;</c-><c- n>class</c-> <c- n>Out</c-><c- o>></c->
  <c- n>Out</c-> <c- n>vformat_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>string_view</c-> <c- n>fmt</c-><c- p>,</c->
                 <c- n>format_args_t</c-><c- o>&lt;</c-><c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-><c- p>,</c-> <c- b>char</c-><c- o>></c-> <c- n>args</c-><c- p>);</c->
</pre>
   <p>Unfortunately it may result in significant code bloat because formatting code
will have to be instantiated for every iterator type used with <code class="highlight"><c- n>format_to</c-></code> or <code class="highlight"><c- n>vformat_to</c-></code>, for example:</p>
<pre class="highlight"><c- n>std</c-><c- o>::</c-><c- n>vector</c-><c- o>&lt;</c-><c- b>char</c-><c- o>></c-> <c- n>v</c-><c- p>;</c->
<c- n>std</c-><c- o>::</c-><c- n>format_to</c-><c- p>(</c-><c- n>std</c-><c- o>::</c-><c- n>back_inserter</c-><c- p>(</c-><c- n>v</c-><c- p>),</c-> <c- s>"{}"</c-><c- p>,</c-> <c- mi>42</c-><c- p>);</c->
<c- c1>// Formatting functions are instantiated for std::back_insert_iterator&lt;std::vector&lt;char>>.</c->

<c- n>std</c-><c- o>::</c-><c- n>string</c-> <c- n>s</c-><c- p>;</c->
<c- n>std</c-><c- o>::</c-><c- n>format_to</c-><c- p>(</c-><c- n>std</c-><c- o>::</c-><c- n>back_inserter</c-><c- p>(</c-><c- n>s</c-><c- p>),</c-> <c- s>"{}"</c-><c- p>,</c-> <c- mi>42</c-><c- p>);</c->
<c- c1>// Formatting functions are instantiated for std::back_insert_iterator&lt;std::string>.</c->
</pre>
   <p>This happens even for argument types that are not formatted,
clearly violating "you donât pay for what you donât use" principle. Also this is
unnecessary because the iterator type can be erased via the internal buffer as
it is done in <code class="highlight"><c- n>format</c-></code> and <code class="highlight"><c- n>vformat</c-></code> without affecting performance for the
common case of containers with contiguous storage. Therefore we propose using <code class="highlight"><c- n>format_args</c-></code> and <code class="highlight"><c- n>wformat_args</c-></code> instead of <code class="highlight"><c- n>format_args_t</c-></code> in these overloads:</p>
<pre class="language-c++ highlight"><c- n>template</c-><c- o>&lt;</c-><c- n>class</c-> <c- n>Out</c-><c- o>></c->
  <c- n>Out</c-> <c- n>vformat_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>string_view</c-> <c- n>fmt</c-><c- p>,</c-> <c- n>format_args</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <p><code class="highlight"><c- n>formatter</c-></code> specializations will continue to support output iterators so this
only affects type-erased API and not the one with compiled format strings that
will be proposed separately. The latter will not be affected by the code bloat
issue because instantiations will be limited only to used argument types.</p>
   <p>In addition to reducing the code bloat this will simplify the API.</p>
   <p>The code bloat problem cannot be solved just as a quality of implementation
issue because the iterator type is observable through the <code class="highlight"><c- n>formatter</c-></code> API.</p>
   <p>This proposal has been successfully implemented in the {fmt} library (<a data-link-type="biblio" href="#biblio-fmt">[FMT]</a>).</p>
   <h2 class="heading settled" data-level="7" id="impact"><span class="secno">7. </span><span class="content">Impact on existing code</span><a class="self-link" href="#impact"></a></h2>
   <p>Making invalid format strings ill-formed and modifying the problematic <code class="highlight"><c- n>vformat_to</c-></code> overloads are breaking changes although at the time of writing none
of the standard libraries implements the Ð¡++20 formatting facility and therefore
there is no code using it.</p>
   <h2 class="heading settled" data-level="8" id="wording"><span class="secno">8. </span><span class="content">Wording</span><a class="self-link" href="#wording"></a></h2>
   <p>All wording is relative to the C++ working draft <a data-link-type="biblio" href="#biblio-n4861">[N4861]</a>.</p>
   <p>Update the value of the feature-testing macro <code class="highlight"><c- n>__cpp_lib_format</c-></code> to the date of
adoption in <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4861.pdf#page=493">[version.syn]</a>:</p>
   <p>Change in <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4861.pdf#page=729">[format.syn]</a>:</p>
<pre class="highlight"><c- k>namespace</c-> <c- n>std</c-> <c- p>{</c->
<ins>  <c- c1>// 20.20.3, error reporting</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>charT</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c-> <c- k>struct</c-> <i><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></i> <c- p>{</c->  <i><c- c1>// exposition only</c-></i>
    <c- n>basic_string_view</c-><c- o>&lt;</c-><c- n>charT</c-><c- o>></c-> <i><c- n>str</c-></i><c- p>;</c->                                    <i><c- c1>// exposition only</c-></i>

    <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>T</c-><c- o>></c-> <c- k>consteval</c-> <i><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- p>(</c-><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-> <c- n>s</c-><c- p>);</c->
  <c- p>};</c->

  <c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- k>using</c-> <i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i> <c- o>=</c->
      <i><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- b>char</c-><c- p>,</c-> <c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Args</c-><c- o>></c-><c- p>...</c-><c- o>></c-><c- p>;</c->     <i><c- c1>// exposition only</c-></i>
  <c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- k>using</c-> <i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i> <c- o>=</c->
      <i><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- b>wchar_t</c-><c- p>,</c-> <c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Args</c-><c- o>></c-><c- p>...</c-><c- o>></c-><c- p>;</c->  <i><c- c1>// exposition only</c-></i></ins>

  <c- c1>// 20.20.4, formatting functions</c->
  <c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>string</c-> <c- n>format</c-><c- p>(</c-><del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>wstring</c-> <c- n>format</c-><c- p>(</c-><del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>string</c-> <c- n>format</c-><c- p>(</c-><c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                  <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>wstring</c-> <c- n>format</c-><c- p>(</c-><c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                   <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->

  <c- p>...</c->

  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>Out</c-> <c- n>format_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>Out</c-> <c- n>format_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>Out</c-> <c- n>format_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                  <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>Out</c-> <c- n>format_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                  <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->

  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- o>></c->
    <c- n>Out</c-> <c- n>vformat_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>string_view</c-> <c- n>fmt</c-><c- p>,</c->
                   <del><c- n>format_args_t</c-><c- o>&lt;</c-><c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-><c- p>,</c-> <c- b>char</c-><c- o>></c-></del><ins><c- n>format_args</c-></ins> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- o>></c->
    <c- n>Out</c-> <c- n>vformat_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>wstring_view</c-> <c- n>fmt</c-><c- p>,</c->
                   <del><c- n>format_args_t</c-><c- o>&lt;</c-><c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>></c-></del><ins><c- n>wformat_args</c-></ins> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- o>></c->
    <c- n>Out</c-> <c- n>vformat_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <c- n>string_view</c-> <c- n>fmt</c-><c- p>,</c->
                   <del><c- n>format_args_t</c-><c- o>&lt;</c-><c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-><c- p>,</c-> <c- b>char</c-><c- o>></c-></del><ins><c- n>format_args</c-></ins> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- o>></c->
    <c- n>Out</c-> <c- n>vformat_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <c- n>wstring_view</c-> <c- n>fmt</c-><c- p>,</c->
                   <del><c- n>format_args_t</c-><c- o>&lt;</c-><c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>></c-></del><ins><c- n>wformat_args</c-></ins> <c- n>args</c-><c- p>);</c->

  <c- p>...</c->

  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>format_to_n_result</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>format_to_n</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>iter_difference_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>n</c-><c- p>,</c->
                                        <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                                        <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>format_to_n_result</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>format_to_n</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>iter_difference_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>n</c-><c- p>,</c->
                                        <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                                        <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>format_to_n_result</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>format_to_n</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>iter_difference_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>n</c-><c- p>,</c->
                                        <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c->
                                        <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                                        <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- n>format_to_n_result</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>format_to_n</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>iter_difference_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>n</c-><c- p>,</c->
                                        <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c->
                                        <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                                        <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->

  <c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- b>size_t</c-> <c- n>formatted_size</c-><c- p>(</c-><del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- b>size_t</c-> <c- n>formatted_size</c-><c- p>(</c-><del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- b>size_t</c-> <c- n>formatted_size</c-><c- p>(</c-><c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                          <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
  <c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
    <c- b>size_t</c-> <c- n>formatted_size</c-><c- p>(</c-><c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                          <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->

  <c- p>...</c->

  <c- c1>// 20.20.6.3, class template basic_format_args</c->
  <c- p>...</c->
<del>  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- k>class</c-> <c- nc>charT</c-><c- o>></c->
    <c- k>using</c-> <c- n>format_args_t</c-> <c- o>=</c-> <c- n>basic_format_args</c-><c- o>&lt;</c-><c- n>basic_format_context</c-><c- o>&lt;</c-><c- n>Out</c-><c- p>,</c-> <c- n>charT</c-><c- o>>></c-><c- p>;</c-></del>
</pre>
   <p>Change in <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4861.pdf#page=732">[format.string.general]</a>:</p>
   <p>
    A <em>format string</em> for arguments <code class="highlight"><c- n>args</c-></code> is a (possibly empty) sequence of
replacement fields, escape sequences, and characters other than <code class="highlight"><c- p>{</c-></code> and <code class="highlight"><c- p>}</c-></code>. 
    <ins> A string <code class="highlight"><c- n>s</c-></code> is a format string for argument types <code class="highlight"><c- n>Args</c-></code> if there exist <code class="highlight"><c- n>args</c-></code> of types <code class="highlight"><c- n>Args</c-></code> such that <code class="highlight"><c- n>s</c-></code> is a format string for <code class="highlight"><c- n>args</c-></code>.</ins>
     Let <code class="highlight"><c- n>charT</c-></code> be the character type of the format string. Each character that is
not part of a replacement field or an escape sequence is copied unchanged to the
output.
   </p>
   <p>...</p>
   <p>If all <em>arg-id</em>s in a format string are omitted (including those in the <em>format-spec</em>, as interpreted by the corresponding <code class="highlight"><c- n>formatter</c-></code> specialization),
argument indices 0, 1, 2, ... will automatically be used in that order. If some <em>arg-id</em>s are omitted and some are present, the string is not a format string.
[Note: A format string cannot contain a mixture of automatic and manual
indexing. â end note] [<em>Example</em>:</p>
<pre class="highlight"><c- n>string</c-> <c- n>s0</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- s>"{} to {}"</c-><c- p>,</c-> <c- s>"a"</c-><c- p>,</c-> <c- s>"b"</c-><c- p>);</c->   <c- c1>// OK, automatic indexing</c->
<c- n>string</c-> <c- n>s1</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- s>"{1} to {0}"</c-><c- p>,</c-> <c- s>"a"</c-><c- p>,</c-> <c- s>"b"</c-><c- p>);</c-> <c- c1>// OK, manual indexing</c->
<c- n>string</c-> <c- n>s2</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- s>"{0} to {}"</c-><c- p>,</c-> <c- s>"a"</c-><c- p>,</c-> <c- s>"b"</c-><c- p>);</c->  <c- c1>// not a format string (mixing automatic and manual indexing),</c->
                                            <c- c1>// </c-><del><c- c1>throws format_error</c-></del><ins><c- c1>ill-formed</c-></ins>
<c- n>string</c-> <c- n>s3</c-> <c- o>=</c-> <c- n>format</c-><c- p>(</c-><c- s>"{} to {1}"</c-><c- p>,</c-> <c- s>"a"</c-><c- p>,</c-> <c- s>"b"</c-><c- p>);</c->  <c- c1>// not a format string (mixing automatic and manual indexing),</c->
                                            <c- c1>// </c-><del><c- c1>throws format_error</c-></del><ins><c- c1>ill-formed</c-></ins>
</pre>
   <p>â <em>end example</em>]</p>
   <p>Change in <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4861.pdf#page=736">[format.err.report]</a>:</p>
   <p>... Failure to allocate storage is reported by throwing an exception as described in
16.5.5.13.</p>
<pre class="highlight"><ins><c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>charT</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c-> <c- k>struct</c-> <i><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></i> <c- p>{</c->  <i><c- c1>// exposition only</c-></i>
  <c- n>basic_string_view</c-><c- o>&lt;</c-><c- n>charT</c-><c- o>></c-> <i><c- n>str</c-></i><c- p>;</c->                                    <i><c- c1>// exposition only</c-></i>

  <c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>T</c-><c- o>></c-> <c- k>consteval</c-> <i><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- p>(</c-><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-> <c- n>s</c-><c- p>);</c->
<c- p>};</c-></ins>
</pre>
<pre class="highlight"><ins><c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>T</c-><c- o>></c-> <c- k>consteval</c-> <i><c- n>basic</c-><c- o>-</c-><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- p>(</c-><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-> <c- n>s</c-><c- p>);</c-></ins>
</pre>
   <ins> <em>Constraints:</em> <code class="highlight"><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-></code> models <code class="highlight"><c- n>convertible_to</c-><c- o>&lt;</c-><c- n>basic_string_view</c-><c- o>&lt;</c-><c- n>charT</c-><c- o>>></c-></code>. </ins>
   <p>
    <ins> <em>Effects:</em> Direct-non-list-initializes <i><code class="highlight"><c- n>str</c-></code></i> with <code class="highlight"><c- n>s</c-></code>. </ins>
   </p>
   <p>
    <ins> <em>Remarks:</em> A call to this function is not a core constant expression
([expr.const]) unless <i><code class="highlight"><c- n>str</c-></code></i> is a format string for <code class="highlight"><c- n>Args</c-></code>. </ins>
   </p>
   <p>Change in <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4861.pdf#page=736">[format.functions]</a>:</p>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>string</c-> <c- n>format</c-><c- p>(</c-><del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <p><em>Effects:</em> Equivalent to:</p>
<pre class="highlight"><c- k>return</c-> <c- nf>vformat</c-><c- p>(</c-><c- n>fmt</c-><ins><c- p>.</c-><i><c- n>str</c-></i></ins><c- p>,</c-> <c- n>make_format_args</c-><c- p>(</c-><c- n>args</c-><c- p>...));</c->
</pre>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>wstring</c-> <c- n>format</c-><c- p>(</c-><del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <p><em>Effects:</em> Equivalent to:</p>
<pre class="highlight"><c- k>return</c-> <c- nf>vformat</c-><c- p>(</c-><c- n>fmt</c-><ins><c- p>.</c-><i><c- n>str</c-></i></ins><c- p>,</c-> <c- n>make_wformat_args</c-><c- p>(</c-><c- n>args</c-><c- p>...));</c->
</pre>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>string</c-> <c- n>format</c-><c- p>(</c-><c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <p><em>Effects:</em> Equivalent to:</p>
<pre class="highlight"><c- k>return</c-> <c- nf>vformat</c-><c- p>(</c-><c- n>loc</c-><c- p>,</c-> <c- n>fmt</c-><ins><c- p>.</c-><i><c- n>str</c-></i></ins><c- p>,</c-> <c- n>make_format_args</c-><c- p>(</c-><c- n>args</c-><c- p>...));</c->
</pre>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>wstring</c-> <c- n>format</c-><c- p>(</c-><c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                 <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <p><em>Effects:</em> Equivalent to:</p>
<pre class="highlight"><c- k>return</c-> <c- nf>vformat</c-><c- p>(</c-><c- n>loc</c-><c- p>,</c-> <c- n>fmt</c-><ins><c- p>.</c-><i><c- n>str</c-></i></ins><c- p>,</c-> <c- n>make_wformat_args</c-><c- p>(</c-><c- n>args</c-><c- p>...));</c->
</pre>
   <p>...</p>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>Out</c-> <c- n>format_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <ins> <em>Effects:</em> Equivalent to: </ins>
<pre class="highlight"><ins><c- k>return</c-> <c- nf>vformat_to</c-><c- p>(</c-><c- n>out</c-><c- p>,</c-> <c- n>fmt</c-><c- p>.</c-><i><c- n>str</c-></i><c- p>,</c-> <c- n>make_format_args</c-><c- p>(</c-><c- n>args</c-><c- p>...));</c-></ins>
</pre>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>Out</c-> <c- n>format_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <p><em>Effects:</em> Equivalent to:</p>
<pre class="highlight"><del><c- k>using</c-> <c- n>context</c-> <c- o>=</c-> <c- n>basic_format_context</c-><c- o>&lt;</c-><c- n>Out</c-><c- p>,</c-> <c- k>decltype</c-><c- p>(</c-><c- n>fmt</c-><c- p>)</c-><c- o>::</c-><c- n>value_type</c-><c- o>></c-><c- p>;</c->
<c- k>return</c-> <c- nf>vformat_to</c-><c- p>(</c-><c- n>out</c-><c- p>,</c-> <c- n>fmt</c-><c- p>,</c-> <c- n>make_format_args</c-><c- o>&lt;</c-><c- n>context</c-><c- o>></c-><c- p>(</c-><c- n>args</c-><c- p>...));</c-></del>
<ins><c- k>return</c-> <c- nf>vformat_to</c-><c- p>(</c-><c- n>out</c-><c- p>,</c-> <c- n>fmt</c-><c- p>.</c-><i><c- n>str</c-></i><c- p>,</c-> <c- n>make_wformat_args</c-><c- p>(</c-><c- n>args</c-><c- p>...));</c-></ins>
</pre>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>Out</c-> <c- n>format_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <ins> <em>Effects:</em> Equivalent to: </ins>
<pre class="highlight"><ins><c- k>return</c-> <c- nf>vformat_to</c-><c- p>(</c-><c- n>out</c-><c- p>,</c-> <c- n>loc</c-><c- p>,</c-> <c- n>fmt</c-><c- p>.</c-><i><c- n>str</c-></i><c- p>,</c-> <c- n>make_format_args</c-><c- p>(</c-><c- n>args</c-><c- p>...));</c-></ins>
</pre>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>Out</c-> <c- n>format_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <p><em>Effects:</em> Equivalent to:</p>
<pre class="highlight"><del><c- k>using</c-> <c- n>context</c-> <c- o>=</c-> <c- n>basic_format_context</c-><c- o>&lt;</c-><c- n>Out</c-><c- p>,</c-> <c- k>decltype</c-><c- p>(</c-><c- n>fmt</c-><c- p>)</c-><c- o>::</c-><c- n>value_type</c-><c- o>></c-><c- p>;</c->
<c- k>return</c-> <c- nf>vformat_to</c-><c- p>(</c-><c- n>out</c-><c- p>,</c-> <c- n>loc</c-><c- p>,</c-> <c- n>fmt</c-><c- p>,</c-> <c- n>make_format_args</c-><c- o>&lt;</c-><c- n>context</c-><c- o>></c-><c- p>(</c-><c- n>args</c-><c- p>...));</c-></del>
<ins><c- k>return</c-> <c- nf>vformat_to</c-><c- p>(</c-><c- n>out</c-><c- p>,</c-> <c- n>loc</c-><c- p>,</c-> <c- n>fmt</c-><c- p>.</c-><i><c- n>str</c-></i><c- p>,</c-> <c- n>make_wformat_args</c-><c- p>(</c-><c- n>args</c-><c- p>...));</c-></ins>
</pre>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- o>></c->
  <c- n>Out</c-> <c- n>vformat_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>string_view</c-> <c- n>fmt</c-><c- p>,</c->
                 <del><c- n>format_args_t</c-><c- o>&lt;</c-><c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-><c- p>,</c-> <c- b>char</c-><c- o>></c-></del><ins><c- n>format_args</c-></ins> <c- n>args</c-><c- p>);</c->
<c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- o>></c->
  <c- n>Out</c-> <c- n>vformat_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>wstring_view</c-> <c- n>fmt</c-><c- p>,</c->
                 <del><c- n>format_args_t</c-><c- o>&lt;</c-><c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>></c-></del><ins><c- n>wformat_args</c-></ins> <c- n>args</c-><c- p>);</c->
<c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- o>></c->
  <c- n>Out</c-> <c- n>vformat_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <c- n>string_view</c-> <c- n>fmt</c-><c- p>,</c->
                 <del><c- n>format_args_t</c-><c- o>&lt;</c-><c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-><c- p>,</c-> <c- b>char</c-><c- o>></c-></del><ins><c- n>format_args</c-></ins> <c- n>args</c-><c- p>);</c->
<c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- o>></c->
  <c- n>Out</c-> <c- n>vformat_to</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <c- n>wstring_view</c-> <c- n>fmt</c-><c- p>,</c->
                 <del><c- n>format_args_t</c-><c- o>&lt;</c-><c- n>type_identity_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>></c-></del><ins><c- n>wformat_args</c-></ins> <c- n>args</c-><c- p>);</c->
</pre>
   <p>...</p>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>format_to_n_result</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>format_to_n</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>iter_difference_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>n</c-><c- p>,</c->
                                      <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                                      <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
<c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>format_to_n_result</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>format_to_n</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>iter_difference_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>n</c-><c- p>,</c->
                                      <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                                      <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
<c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>format_to_n_result</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>format_to_n</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>iter_difference_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>n</c-><c- p>,</c->
                                      <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c->
                                      <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                                      <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
<c- k>template</c-><c- o>&lt;</c-><c- k>class</c-> <c- nc>Out</c-><c- p>,</c-> <c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- n>format_to_n_result</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>format_to_n</c-><c- p>(</c-><c- n>Out</c-> <c- n>out</c-><c- p>,</c-> <c- n>iter_difference_t</c-><c- o>&lt;</c-><c- n>Out</c-><c- o>></c-> <c- n>n</c-><c- p>,</c->
                                      <c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c->
                                      <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                                      <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <p>Let</p>
   <p>â <code class="highlight"><c- n>charT</c-></code> be <code class="highlight"><c- k>decltype</c-><c- p>(</c-><c- n>fmt</c-><ins><c- p>.</c-><i><c- n>str</c-></i></ins><c- p>)</c-><c- o>::</c-><c- n>value_type</c-></code></p>
   <p>...</p>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- b>size_t</c-> <c- n>formatted_size</c-><c- p>(</c-><del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
<c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- b>size_t</c-> <c- n>formatted_size</c-><c- p>(</c-><del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c-> <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
<c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- b>size_t</c-> <c- n>formatted_size</c-><c- p>(</c-><c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>string_view</c-></del><ins><i><c- n>format</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                        <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
<c- k>template</c-><c- o>&lt;</c-><c- n>class</c-><c- p>...</c-> <c- n>Args</c-><c- o>></c->
  <c- b>size_t</c-> <c- n>formatted_size</c-><c- p>(</c-><c- k>const</c-> <c- n>locale</c-><c- o>&amp;</c-> <c- n>loc</c-><c- p>,</c-> <del><c- n>wstring_view</c-></del><ins><i><c- n>wformat</c-><c- o>-</c-><c- n>string</c-></i><c- o>&lt;</c-><c- n>Args</c-><c- p>...</c-><c- o>></c-></ins> <c- n>fmt</c-><c- p>,</c->
                        <c- k>const</c-> <c- n>Args</c-><c- o>&amp;</c-><c- p>...</c-> <c- n>args</c-><c- p>);</c->
</pre>
   <p>Let <code class="highlight"><c- n>charT</c-></code> be <code class="highlight"><c- k>decltype</c-><c- p>(</c-><c- n>fmt</c-><ins><c- p>.</c-><i><c- n>str</c-></i></ins><c- p>)</c-><c- o>::</c-><c- n>value_type</c-></code>.</p>
   <p>...</p>
   <p>Add to Annex C (informative) Compatibility <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4861.pdf#page=1641">[diff]</a> the following new subclause:</p>
   <p>
    <ins> <strong>C.? C++ and ISO C++ 2020</strong> [diff.cpp20] </ins>
   </p>
   <p>
    <ins> This subclause lists the differences between C++ and ISO C++ 2020 (ISO/IEC
14882:2017, Programming Languages â C++), by the chapters of this document. </ins>
   </p>
   <p>
    <ins> <strong>C.?.1 Clause 20: general utilities library</strong> [diff.cpp20.utilities] </ins>
   </p>
   <p>
    <ins> <strong>Affected subclauses:</strong> 20.20<br> <strong>Change:</strong> Signature changes: <code class="highlight"><c- n>format</c-></code>, <code class="highlight"><c- n>format_to</c-></code>, <code class="highlight"><c- n>vformat_to</c-></code>, <code class="highlight"><c- n>format_to_n</c-></code>, <code class="highlight"><c- n>formatted_size</c-></code>. Removal of <code class="highlight"><c- n>format_args_t</c-></code>.<br> <strong>Rationale:</strong> Improve safety via compile-time format string checks, avoid
unnecessary template instantiations.<br> <strong>Effect on original feature:</strong> Valid C++20 code that contained errors in format
strings or relied on previous format string signatures or <code class="highlight"><c- n>format_args_t</c-></code> may
become ill-formed. For example: </ins>
   </p>
<pre class="highlight"><ins><c- k>auto</c-> <c- n>s</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>format</c-><c- p>(</c-><c- s>"{:d}"</c-><c- p>,</c-> <c- s>"I am not a number"</c-><c- p>);</c-> <c- c1>// ill-formed,</c->
                                                   <c- c1>// previously threw format_error </c->
</ins></pre>
   <h2 class="heading settled" data-level="9" id="ack"><span class="secno">9. </span><span class="content">Acknowledgements</span><a class="self-link" href="#ack"></a></h2>
   <p>Thanks to Hana DusÃ­kovÃ¡ for demonstrating that the optimal formatting API can be
implemented with P1221 and Tim Song for reviewing the wording.</p>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">â</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">â</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">â</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Donât scroll to compensate for the ToC if weâre above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I donât know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldnât exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isnât standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we donât have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While weâre at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Canât find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-codesearch">[CODESEARCH]
   <dd>Andrew Tomazos. <a href="https://codesearch.isocpp.org">Code search engine website</a>. URL: <a href="https://codesearch.isocpp.org">https://codesearch.isocpp.org</a>
   <dt id="biblio-d-format">[D-FORMAT]
   <dd><a href="https://dlang.org/phobos/std_format.html">D Library Reference, std.format</a>. URL: <a href="https://dlang.org/phobos/std_format.html">https://dlang.org/phobos/std_format.html</a>
   <dt id="biblio-fmt">[FMT]
   <dd>Victor Zverovich; et al. <a href="https://github.com/fmtlib/fmt">The {fmt} library</a>. URL: <a href="https://github.com/fmtlib/fmt">https://github.com/fmtlib/fmt</a>
   <dt id="biblio-n4861">[N4861]
   <dd>Richard Smith; et al. <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4861.pdf">Working Draft, Standard for Programming Language C++</a>. URL: <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4861.pdf">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4861.pdf</a>
   <dt id="biblio-p0645">[P0645]
   <dd>Victor Zverovich. <a href="https://wg21.link/p0645">Text Formatting</a>. URL: <a href="https://wg21.link/p0645">https://wg21.link/p0645</a>
   <dt id="biblio-p1045">[P1045]
   <dd>David Stone. <a href="http://wg21.link/p1045">constexpr Function Parameters</a>. URL: <a href="http://wg21.link/p1045">http://wg21.link/p1045</a>
   <dt id="biblio-p1221">[P1221]
   <dd>Jason Rice. <a href="http://wg21.link/p1221">Parametric Expressions</a>. URL: <a href="http://wg21.link/p1221">http://wg21.link/p1221</a>
   <dt id="biblio-rust-fmt">[RUST-FMT]
   <dd><a href="https://doc.rust-lang.org/std/fmt/">The Rust Standard Library, Module std::fmt</a>. URL: <a href="https://doc.rust-lang.org/std/fmt/">https://doc.rust-lang.org/std/fmt/</a>
  </dl>